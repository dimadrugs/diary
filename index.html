<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <title>–î–Ω–µ–≤–Ω–∏–∫</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#000">
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
  <style>
    :root{--bg:#000;--bg2:#1c1c1e;--bg3:#2c2c2e;--card:#1c1c1e;--text:#fff;--t2:rgba(255,255,255,.7);--t3:rgba(255,255,255,.4);--t4:rgba(255,255,255,.12);--blue:#0a84ff;--green:#30d158;--orange:#ff9f0a;--red:#ff453a;--purple:#bf5af2;--r:14px;--rs:10px}
    [data-theme="light"]{--bg:#f2f2f7;--bg2:#fff;--bg3:#e5e5ea;--card:#fff;--text:#000;--t2:rgba(0,0,0,.6);--t3:rgba(0,0,0,.35);--t4:rgba(0,0,0,.08);--blue:#007aff;--green:#34c759;--orange:#ff9500;--red:#ff3b30;--purple:#af52de}
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html{height:100%;height:-webkit-fill-available}
    body{font-family:-apple-system,'SF Pro Display',BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);min-height:100%;min-height:-webkit-fill-available;-webkit-font-smoothing:antialiased;overflow-x:hidden}
    ::-webkit-scrollbar{width:0;height:0}

    /* LOADER */
    #loader{position:fixed;inset:0;background:var(--bg);z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .4s}
    #loader.hide{opacity:0;pointer-events:none}
    #loader img{width:72px;height:72px;border-radius:16px;margin-bottom:16px;animation:pulse 1.2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(.92);opacity:.6}}
    #loader .lt{font-size:15px;color:var(--t3);font-weight:600}

    /* LOGIN */
    #loginPage{display:none;min-height:100vh;align-items:center;justify-content:center;padding:24px}
    .lc{width:100%;max-width:360px;text-align:center}
    .lc img{width:64px;height:64px;border-radius:14px;margin-bottom:16px}
    .lc h1{font-size:28px;font-weight:700;margin-bottom:4px}
    .lc .sub{color:var(--t3);font-size:15px;margin-bottom:32px}
    .errMsg{background:rgba(255,69,58,.15);color:var(--red);padding:12px;border-radius:var(--rs);margin-bottom:16px;font-size:14px;font-weight:600;display:none}
    .inp{width:100%;padding:16px;font-size:16px;background:var(--bg2);color:var(--text);border:1px solid var(--t4);border-radius:var(--r);font-family:inherit;outline:none;margin-bottom:12px;-webkit-appearance:none}
    .inp:focus{border-color:var(--blue)}
    textarea.inp{resize:vertical;min-height:80px}
    .btnP{display:block;width:100%;padding:16px;border:none;border-radius:var(--r);background:var(--blue);color:#fff;font-size:17px;font-weight:600;font-family:inherit;cursor:pointer}
    .btnP:active{opacity:.7}
    .btnS{display:block;width:100%;padding:16px;border:none;border-radius:var(--r);background:var(--bg2);color:var(--text);font-size:17px;font-weight:600;font-family:inherit;cursor:pointer;border:1px solid var(--t4)}
    .btnS:active{opacity:.7}
    .btnD{display:block;width:100%;padding:16px;border:none;border-radius:var(--r);background:var(--red);color:#fff;font-size:17px;font-weight:600;font-family:inherit;cursor:pointer}
    .sep{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--t3);font-size:13px}
    .sep::before,.sep::after{content:'';flex:1;height:1px;background:var(--t4)}

    /* APP */
    #app{display:none}

    /* TOP BAR */
    .topbar{position:sticky;top:0;z-index:100;background:var(--bg);padding:8px 16px 8px;padding-top:calc(8px + env(safe-area-inset-top))}
    .topbar-inner{display:flex;justify-content:space-between;align-items:center}
    .tb-left{display:flex;align-items:center;gap:8px}
    .tb-left img{width:28px;height:28px;border-radius:6px}
    .tb-title{font-size:22px;font-weight:700}
    .tb-right{display:flex;align-items:center;gap:6px}
    .pill{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700}
    .pill.up{background:rgba(48,209,88,.15);color:var(--green)}
    .pill.lo{background:rgba(255,69,58,.15);color:var(--red)}
    .ham{width:34px;height:34px;border-radius:50%;background:var(--bg2);border:none;color:var(--text);font-size:16px;display:flex;align-items:center;justify-content:center;cursor:pointer}
    .ham:active{transform:scale(.9)}
    .tb-date{font-size:12px;color:var(--t3);margin-top:2px;font-weight:500}

    /* POPUP MENU ‚Äî above everything */
    .pm-bg{position:fixed;inset:0;z-index:9000;display:none}
    .pm-bg.open{display:block}
    .pm{position:fixed;z-index:9001;background:var(--bg2);border:1px solid var(--t4);border-radius:16px;padding:6px;min-width:200px;box-shadow:0 12px 40px rgba(0,0,0,.5);transform:scale(.2);opacity:0;transform-origin:top right;transition:transform .25s cubic-bezier(.34,1.56,.64,1),opacity .15s;pointer-events:none}
    .pm.open{transform:scale(1);opacity:1;pointer-events:all}
    [data-theme="light"] .pm{box-shadow:0 12px 40px rgba(0,0,0,.12)}
    .pm-item{display:flex;align-items:center;gap:10px;padding:12px 14px;font-size:15px;font-weight:600;color:var(--text);cursor:pointer;border:none;background:none;width:100%;text-align:left;font-family:inherit;border-radius:10px}
    .pm-item:active{background:var(--bg3)}
    .pm-item .pi{font-size:18px;width:24px;text-align:center}
    .pm-item.red{color:var(--red)}
    .pm-sep{height:1px;background:var(--t4);margin:4px 8px}
    .pm-info{padding:10px 14px;font-size:12px;color:var(--t3)}

    /* MOBILE WEEK STRIP */
    .wbar{padding:4px 16px 10px}
    .wrow{display:flex;align-items:center;gap:3px}
    .warr{width:28px;height:46px;flex-shrink:0;background:var(--bg2);border:none;border-radius:var(--rs);color:var(--t2);font-size:16px;display:flex;align-items:center;justify-content:center;cursor:pointer}
    .warr:active{transform:scale(.9)}
    .dchip{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 0 8px;border-radius:12px;cursor:pointer;position:relative;background:transparent;border:none;color:var(--text);font-family:inherit;min-width:0}
    .dchip .dd{font-size:10px;font-weight:700;color:var(--t3);text-transform:uppercase}
    .dchip .dn{font-size:16px;font-weight:700}
    .dchip:active{transform:scale(.94)}
    .dchip.sel{background:var(--blue);color:#fff}
    .dchip.sel .dd{color:rgba(255,255,255,.7)}
    .dchip.today:not(.sel)::after{content:'';position:absolute;bottom:3px;width:4px;height:4px;border-radius:50%;background:var(--blue)}
    .dchip .dot{position:absolute;top:2px;right:2px;width:5px;height:5px;border-radius:50%;background:var(--orange)}
    .wlabel{text-align:center;padding:3px 0 0;font-size:11px;color:var(--t3);font-weight:600}
    .wlabel .up{color:var(--green)}
    .wlabel .lo{color:var(--red)}

    /* BOTTOM NAV ‚Äî absolutely stuck to bottom edge */
    .bnav{position:fixed;left:0;right:0;bottom:0;z-index:200;background:var(--bg2);border-top:1px solid var(--t4);display:flex;padding-bottom:env(safe-area-inset-bottom)}
    [data-theme="light"] .bnav{background:rgba(255,255,255,.94);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
    .bnav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;border:none;background:none;color:var(--t3);font-size:10px;font-weight:600;font-family:inherit;cursor:pointer;padding:8px 0;position:relative}
    .bnav-btn .bi{font-size:22px}
    .bnav-btn:active .bi{transform:scale(.85)}
    .bnav-btn.on{color:var(--blue)}

    /* CONTENT */
    .content{padding:0 16px;padding-bottom:calc(60px + env(safe-area-inset-bottom))}
    .pg{display:none}
    .pg.on{display:block;animation:fu .25s ease}
    @keyframes fu{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    /* LESSON CARDS */
    .ll{display:flex;flex-direction:column;gap:6px}
    .lc2{background:var(--card);border-radius:var(--r);padding:12px 14px;display:flex;gap:10px;border:1px solid var(--t4);cursor:pointer;position:relative}
    .lc2:active{transform:scale(.98)}
    .lc2.empty{opacity:.3;cursor:default}
    .lc2.empty:active{transform:none}
    .lc2.changed{border-left:3px solid var(--orange)}
    .pn2{width:40px;height:48px;background:rgba(10,132,255,.1);border-radius:var(--rs);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0}
    [data-theme="light"] .pn2{background:rgba(0,122,255,.08)}
    .pn2 .n{font-size:18px;font-weight:800;color:var(--blue)}
    .pn2 .t{font-size:8px;color:var(--t3);font-weight:600;margin-top:1px}
    .lb{flex:1;min-width:0}
    .lb .ln{font-size:15px;font-weight:700;margin-bottom:2px}
    .lb .lm{display:flex;gap:8px;font-size:12px;color:var(--t2);flex-wrap:wrap}
    .lb .le{color:var(--t3);font-size:13px}
    .la{position:absolute;top:8px;right:8px;display:flex;gap:3px}
    .mb{padding:3px 7px;border-radius:6px;border:none;font-size:11px;font-weight:700;font-family:inherit;cursor:pointer}
    .mb:active{opacity:.6}
    .mb.bl{background:rgba(10,132,255,.15);color:var(--blue)}
    .mb.gr{background:rgba(48,209,88,.15);color:var(--green)}
    .mb.rd{background:rgba(255,69,58,.15);color:var(--red)}
    .mb.og{background:rgba(255,159,10,.15);color:var(--orange)}

    .hwi{margin-top:6px;padding:8px 10px;background:rgba(10,132,255,.06);border-radius:var(--rs);border-left:3px solid var(--blue)}
    [data-theme="light"] .hwi{background:rgba(0,122,255,.04)}
    .hwi.done{opacity:.4}
    .hwi .hh{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}
    .hwi .ht{font-size:9px;font-weight:700;text-transform:uppercase;color:var(--blue);letter-spacing:.3px}
    .hwi .htx{font-size:13px;line-height:1.4}
    .hwi.done .htx{text-decoration:line-through}
    .hwi .hb{display:flex;gap:3px}
    .hwi .hp{display:flex;gap:4px;margin-top:4px;flex-wrap:wrap}
    .hwi .hp img{width:48px;height:48px;object-fit:cover;border-radius:6px;cursor:pointer;border:1px solid var(--t4)}

    .pgh{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;gap:8px;flex-wrap:wrap}
    .pgh h2{font-size:20px;font-weight:700}
    .empty{text-align:center;padding:50px 20px;color:var(--t3)}
    .empty .ei{font-size:44px;margin-bottom:8px;opacity:.5}
    .empty .et{font-size:14px}

    .evC{background:var(--card);border-radius:var(--r);padding:14px;border:1px solid var(--t4);border-left:3px solid var(--orange);margin-bottom:8px}
    .evC .evt{font-size:14px;font-weight:700;margin-bottom:3px}
    .evC .evd{font-size:12px;color:var(--t3)}

    .gradeTabs{display:flex;gap:3px;margin-bottom:14px;background:var(--bg2);border-radius:var(--rs);padding:3px}
    .gTab{flex:1;padding:9px;border:none;border-radius:7px;background:transparent;color:var(--t3);font-size:13px;font-weight:700;font-family:inherit;cursor:pointer;text-align:center}
    .gTab.on{background:var(--blue);color:#fff}
    .gCon{display:none}.gCon.on{display:block;animation:fu .2s ease}
    .fp{text-align:center;padding:50px 20px}
    .fp .fi{font-size:48px;margin-bottom:10px}
    .fp h3{font-size:18px;font-weight:700;margin-bottom:6px}
    .fp p{font-size:13px;color:var(--t3);line-height:1.5;max-width:260px;margin:0 auto}

    .hwC{background:var(--card);border-radius:var(--r);padding:14px;border:1px solid var(--t4);border-left:3px solid var(--blue);margin-bottom:8px}
    .hwC .hs{font-size:14px;font-weight:700;color:var(--blue);margin-bottom:3px}
    .hwC .hd{font-size:11px;color:var(--t3);margin-bottom:8px}
    .hwC .htk{font-size:13px;line-height:1.5;padding:8px;background:var(--bg2);border-radius:var(--rs);margin-bottom:8px}
    .hwC .ha{display:flex;gap:6px}
    .hwC .hp{display:flex;gap:4px;margin-bottom:8px;flex-wrap:wrap}
    .hwC .hp img{width:64px;height:64px;object-fit:cover;border-radius:6px;cursor:pointer;border:1px solid var(--t4)}

    .sjR{display:flex;align-items:center;gap:10px;padding:12px 14px;background:var(--card);border-radius:var(--r);border:1px solid var(--t4);margin-bottom:6px}
    .sjR .si{width:36px;height:36px;border-radius:var(--rs);background:rgba(10,132,255,.1);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
    .sjR .sn{font-weight:700;font-size:14px}
    .sjR .sm{font-size:12px;color:var(--t2)}
    .chC{background:var(--card);border-radius:var(--r);padding:14px;border:1px solid var(--t4);border-left:3px solid var(--orange);margin-bottom:8px}
    .chC .chead{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;flex-wrap:wrap;gap:4px}
    .chC .cdt{font-weight:700;color:var(--orange);font-size:14px}
    .chL{display:flex;gap:6px;align-items:center;padding:6px;background:var(--bg2);border-radius:var(--rs);margin-bottom:3px}
    .chL .cn{width:22px;height:22px;border-radius:5px;background:rgba(255,159,10,.15);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:11px;color:var(--orange);flex-shrink:0}
    .stR{display:flex;justify-content:space-between;align-items:center;padding:14px;background:var(--card);border-radius:var(--r);border:1px solid var(--t4);margin-bottom:6px;gap:10px;flex-wrap:wrap}
    .stR h4{font-size:14px;font-weight:700}
    .stR p{font-size:12px;color:var(--t3)}

    .photoArea{margin-top:6px}
    .photoBtn{display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:var(--bg3);border:1px dashed var(--t4);border-radius:var(--rs);color:var(--t2);font-size:13px;font-weight:600;cursor:pointer}
    .photoPrev{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap}
    .photoPrev .pp{position:relative;width:60px;height:60px}
    .photoPrev .pp img{width:100%;height:100%;object-fit:cover;border-radius:6px;border:1px solid var(--t4)}
    .photoPrev .pp .pr{position:absolute;top:-3px;right:-3px;width:18px;height:18px;border-radius:50%;background:var(--red);color:#fff;border:none;font-size:11px;font-weight:800;display:flex;align-items:center;justify-content:center;cursor:pointer}

    .imgV{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:10000;display:none;align-items:center;justify-content:center;cursor:pointer}
    .imgV.open{display:flex}
    .imgV img{max-width:95%;max-height:90vh;border-radius:8px;object-fit:contain}

    .sheet{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:8000;display:none;align-items:flex-end;justify-content:center}
    [data-theme="light"] .sheet{background:rgba(0,0,0,.3)}
    .sheet.open{display:flex}
    .shBox{background:var(--bg2);width:100%;max-width:500px;border-radius:20px 20px 0 0;padding:0 20px calc(20px + env(safe-area-inset-bottom));max-height:90vh;overflow-y:auto;animation:shUp .3s cubic-bezier(.32,.72,0,1)}
    @keyframes shUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
    .shH{width:36px;height:4px;background:var(--t4);border-radius:2px;margin:10px auto 14px}
    .shBox h3{font-size:18px;font-weight:700;margin-bottom:14px}
    .shBtns{display:flex;gap:6px;margin-top:16px;padding-bottom:6px}
    .shBtns .btnP,.shBtns .btnS,.shBtns .btnD{flex:1;padding:13px;font-size:15px}

    .csTrig{display:flex;align-items:center;gap:8px;padding:12px 14px;background:var(--bg3);border:1px solid var(--t4);border-radius:var(--r);cursor:pointer;min-height:48px}
    .csTrig.open{border-color:var(--blue);border-radius:var(--r) var(--r) 0 0}
    .csTrig .csI{width:28px;height:28px;border-radius:7px;background:rgba(10,132,255,.1);display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
    .csTrig .csN{font-weight:700;font-size:13px}
    .csTrig .csM{font-size:11px;color:var(--t3)}
    .csTrig .csPh{color:var(--t3);font-size:13px}
    .csTrig .csArr{color:var(--t3);font-size:9px;transition:transform .2s;margin-left:auto}
    .csTrig.open .csArr{transform:rotate(180deg)}
    .csDd{position:absolute;top:100%;left:0;right:0;background:var(--bg2);border:1px solid var(--blue);border-top:1px solid var(--t4);border-radius:0 0 var(--r) var(--r);max-height:180px;overflow-y:auto;z-index:50;display:none;box-shadow:0 12px 40px rgba(0,0,0,.3)}
    .csDd.open{display:block}
    .csOpt{display:flex;align-items:center;gap:8px;padding:10px 14px;cursor:pointer;border-bottom:1px solid var(--t4)}
    .csOpt:last-child{border:none}
    .csOpt:active{background:var(--bg3)}
    .csOpt.on{background:rgba(10,132,255,.08)}
    .csOpt .coI{width:24px;height:24px;border-radius:6px;background:rgba(10,132,255,.1);display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}
    .csOpt .coN{font-weight:700;font-size:13px}
    .csOpt .coM{font-size:10px;color:var(--t3)}
    .csOpt.emp .coI{background:rgba(255,69,58,.1)}
    .csW{position:relative;width:100%}
    .cpB{background:var(--bg3);border-radius:var(--rs);padding:10px;margin-bottom:6px}
    .cpB .cpH{display:flex;align-items:center;gap:6px;margin-bottom:6px}
    .cpB .cpN{width:22px;height:22px;border-radius:5px;background:rgba(10,132,255,.1);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:11px;color:var(--blue)}

    .admH{display:none!important}

    /* ===== DESKTOP ===== */
    @media(min-width:900px){
      .bnav{display:none!important}
      .wbar{display:none!important}
      .content{padding-bottom:24px!important;max-width:100%;padding:0}
      .topbar .topbar-inner{max-width:1200px;margin:0 auto}

      #deskWrap{display:flex;gap:24px;max-width:1200px;margin:0 auto;padding:0 24px;align-items:flex-start}
      #deskMain{flex:1;min-width:0}
      #deskSide{width:280px;flex-shrink:0;position:sticky;top:calc(70px + env(safe-area-inset-top))}

      .dNav{display:flex;flex-direction:column;gap:3px;margin-bottom:14px;background:var(--card);border-radius:var(--r);padding:6px;border:1px solid var(--t4)}
      .dNavBtn{display:flex;align-items:center;gap:8px;padding:10px 12px;border:none;background:none;border-radius:var(--rs);font-size:14px;font-weight:600;color:var(--t2);cursor:pointer;font-family:inherit;width:100%;text-align:left}
      .dNavBtn:hover{background:var(--bg3)}
      .dNavBtn.on{background:var(--blue);color:#fff}
      .dNavBtn .di{font-size:18px;width:24px;text-align:center}

      .mCal{background:var(--card);border-radius:var(--r);padding:14px;border:1px solid var(--t4);margin-bottom:14px}
      .mCal .mch{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
      .mCal .mct{font-size:15px;font-weight:700}
      .mCal .mca{display:flex;gap:4px}
      .mCal .mcab{width:28px;height:28px;border-radius:50%;background:var(--bg3);border:none;color:var(--text);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}
      .mCal .mcg{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;text-align:center}
      .mCal .mcdh{font-size:10px;font-weight:700;color:var(--t3);padding:4px 0;text-transform:uppercase}
      .mCal .mcd{font-size:12px;padding:6px 2px;border-radius:6px;cursor:pointer;font-weight:600;color:var(--t2)}
      .mCal .mcd:hover{background:var(--bg3)}
      .mCal .mcd.today{background:var(--blue);color:#fff}
      .mCal .mcd.sel{background:rgba(10,132,255,.2);color:var(--blue)}
      .mCal .mcd.other{opacity:.2}

      /* DESKTOP SCHEDULE: vertical days list */
      .dWeekHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;gap:10px}
      .dWeekHead h2{font-size:20px;font-weight:700}
      .dWeekHead .dwb{font-size:12px;font-weight:700;padding:4px 10px;border-radius:16px}
      .dWeekHead .dwb.up{background:rgba(48,209,88,.15);color:var(--green)}
      .dWeekHead .dwb.lo{background:rgba(255,69,58,.15);color:var(--red)}
      .dWeekHead .dwn{display:flex;gap:4px;align-items:center}
      .dWeekHead .dwnb{width:32px;height:32px;border-radius:50%;background:var(--bg2);border:none;color:var(--text);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center}
      .dWeekHead .dwnb:active{transform:scale(.9)}

      .dDayBlock{background:var(--card);border-radius:var(--r);border:1px solid var(--t4);margin-bottom:12px;overflow:hidden}
      .dDayBlock.today{border-color:var(--blue)}
      .dDayBlock.hasch{border-color:var(--orange)}
      .dDayHead{padding:10px 14px;background:var(--bg3);border-bottom:1px solid var(--t4);display:flex;justify-content:space-between;align-items:center}
      .dDayHead .ddh-name{font-size:14px;font-weight:700}
      .dDayHead .ddh-date{font-size:12px;color:var(--t3)}
      .dDayHead .ddh-badge{font-size:9px;padding:2px 6px;border-radius:8px;font-weight:700;background:rgba(255,159,10,.15);color:var(--orange)}
      .dDayBody{padding:8px}
      .dLesson{display:flex;gap:10px;padding:8px 10px;border-radius:var(--rs);margin-bottom:4px;cursor:pointer;transition:background .15s}
      .dLesson:hover{background:var(--bg3)}
      .dLesson.empty{opacity:.25}
      .dLesson.changed{border-left:2px solid var(--orange);padding-left:8px}
      .dLesson .dl-pair{font-size:10px;font-weight:800;color:var(--blue);min-width:60px}
      .dLesson .dl-name{font-size:13px;font-weight:700}
      .dLesson .dl-meta{font-size:11px;color:var(--t3)}
      .dLesson .dl-empty{font-size:12px;color:var(--t3)}
    }

    @media(max-width:899px){
      #deskWrap{display:none!important}
    }
    @media(max-width:380px){
      .tb-title{font-size:20px}
      .dchip .dn{font-size:15px}
    }
  </style>
</head>
<body>

<div id="loader"><img src="icon.png"><div class="lt">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>

<div id="loginPage">
  <div class="lc">
    <img src="icon.png"><h1>–î–Ω–µ–≤–Ω–∏–∫</h1><p class="sub">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</p>
    <div class="errMsg" id="errMsg"></div>
    <input class="inp" type="email" id="iE" placeholder="Email" autocomplete="email">
    <input class="inp" type="password" id="iP" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
    <button class="btnP" onclick="doLogin()">–í–æ–π—Ç–∏</button>
    <div class="sep">–∏–ª–∏</div>
    <button class="btnS" onclick="guestIn()">–ì–æ—Å—Ç–µ–≤–æ–π –≤—Ö–æ–¥</button>
  </div>
</div>

<div id="app">
  <div class="topbar">
    <div class="topbar-inner">
      <div class="tb-left"><img src="icon.png"><div class="tb-title">–î–Ω–µ–≤–Ω–∏–∫</div></div>
      <div class="tb-right">
        <span class="pill" id="tBdg"></span>
        <button class="ham" id="hamBtn" onclick="togPM()">‚ò∞</button>
      </div>
    </div>
    <div class="tb-date" id="tDate"></div>
  </div>

  <div class="pm-bg" id="pmBg" onclick="closePM()"></div>
  <div class="pm" id="pmMenu">
    <div class="pm-info" id="pmInfo"></div>
    <button class="pm-item" onclick="go('pgGrades');closePM()"><span class="pi">üìä</span>–û—Ü–µ–Ω–∫–∏</button>
    <button class="pm-item" onclick="go('pgChat');closePM()"><span class="pi">üí¨</span>–ß–∞—Ç</button>
    <div class="pm-sep"></div>
    <button class="pm-item admH" onclick="go('pgChg');closePM()"><span class="pi">üîÑ</span>–ó–∞–º–µ–Ω—ã</button>
    <button class="pm-item admH" onclick="go('pgSubj');closePM()"><span class="pi">üìñ</span>–ü—Ä–µ–¥–º–µ—Ç—ã</button>
    <button class="pm-item admH" onclick="go('pgHw');closePM()"><span class="pi">üìù</span>–î–ó</button>
    <button class="pm-item" onclick="go('pgSet');closePM()"><span class="pi">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <div class="pm-sep"></div>
    <button class="pm-item red" onclick="doLogout()"><span class="pi">üö™</span>–í—ã–π—Ç–∏</button>
  </div>

  <div class="wbar" id="wbar"><div class="wrow" id="wrow"></div><div class="wlabel" id="wlabel"></div></div>

  <!-- DESKTOP LAYOUT -->
  <div id="deskWrap">
    <div id="deskMain">
      <div class="dWeekHead" id="dwHead"></div>
      <div id="dwBody"></div>
      <div id="dPgArea"></div>
    </div>
    <div id="deskSide">
      <div class="dNav" id="dNav">
        <button class="dNavBtn on" data-dp="sched"><span class="di">üìÖ</span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
        <button class="dNavBtn" data-dp="pgEvents"><span class="di">üìå</span>–°–æ–±—ã—Ç–∏—è</button>
        <button class="dNavBtn" data-dp="pgGrades"><span class="di">üìä</span>–û—Ü–µ–Ω–∫–∏</button>
        <button class="dNavBtn" data-dp="pgChat"><span class="di">üí¨</span>–ß–∞—Ç</button>
        <button class="dNavBtn admH" data-dp="pgHw"><span class="di">üìù</span>–î–ó</button>
        <button class="dNavBtn admH" data-dp="pgChg"><span class="di">üîÑ</span>–ó–∞–º–µ–Ω—ã</button>
        <button class="dNavBtn admH" data-dp="pgSubj"><span class="di">üìñ</span>–ü—Ä–µ–¥–º–µ—Ç—ã</button>
        <button class="dNavBtn" data-dp="pgSet"><span class="di">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
      <div class="mCal" id="mCal"></div>
    </div>
  </div>

  <!-- MOBILE PAGES -->
  <div class="content">
    <div class="pg on" id="pgSched"><div class="ll" id="lList"></div></div>
    <div class="pg" id="pgEvents"><div class="pgh"><h2>–°–æ–±—ã—Ç–∏—è</h2></div><div id="evList"></div></div>
    <div class="pg" id="pgGrades"><div class="pgh"><h2>–û—Ü–µ–Ω–∫–∏</h2></div><div class="gradeTabs"><button class="gTab on" onclick="sGT(0)">–ñ—É—Ä–Ω–∞–ª</button><button class="gTab" onclick="sGT(1)">–ó–∞—á—ë—Ç–∫–∞</button></div><div class="gCon on" id="grJ"><div class="fp"><div class="fi">üìä</div><h3>–ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫</h3><p>–û—Ü–µ–Ω–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏</p></div></div><div class="gCon" id="grR"><div class="fp"><div class="fi">üìã</div><h3>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∑–∞—á—ë—Ç–∫–∞</h3><p>–ó–∞—á—ë—Ç—ã –∏ —ç–∫–∑–∞–º–µ–Ω—ã ‚Äî —Å–∫–æ—Ä–æ</p></div></div></div>
    <div class="pg" id="pgHw"><div class="pgh"><h2>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h2><button class="btnP admH" onclick="openNewHw()" style="padding:8px 14px;font-size:13px;width:auto">+ –î–æ–±–∞–≤–∏—Ç—å</button></div><div id="hwList"></div></div>
    <div class="pg" id="pgChat"><div class="fp"><div class="fi">üí¨</div><h3>–ß–∞—Ç –≥—Ä—É–ø–ø—ã</h3><p>–°–∫–æ—Ä–æ!</p></div></div>
    <div class="pg admH" id="pgChg"><div class="pgh"><h2>–ó–∞–º–µ–Ω—ã</h2><button class="btnP" onclick="openChgM()" style="padding:8px 14px;font-size:13px;width:auto">+ –î–æ–±–∞–≤–∏—Ç—å</button></div><div id="chgList"></div></div>
    <div class="pg admH" id="pgSubj"><div class="pgh"><h2>–ü—Ä–µ–¥–º–µ—Ç—ã</h2><button class="btnP" onclick="openSjM()" style="padding:8px 14px;font-size:13px;width:auto">+ –î–æ–±–∞–≤–∏—Ç—å</button></div><div id="sjList"></div></div>
    <div class="pg" id="pgSet"><h2 style="margin-bottom:14px">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2><div class="stR"><div><h4>–¢–µ–º–∞</h4></div><button class="btnS" onclick="togTh()" style="width:auto;padding:8px 14px;font-size:13px">–°–º–µ–Ω–∏—Ç—å</button></div><div class="stR admH"><div><h4>–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª—å</h4></div><input type="date" class="inp" id="cfgWS" style="width:auto;margin:0;padding:8px"></div><div class="stR admH"><div><h4>–í—Ä–µ–º—è –ø–∞—Ä</h4></div><button class="btnS" onclick="openTM()" style="width:auto;padding:8px 14px;font-size:13px">–ò–∑–º–µ–Ω–∏—Ç—å</button></div><div class="stR admH"><div><h4>–û—á–∏—Å—Ç–∏—Ç—å</h4></div><button class="btnD" onclick="clrAll()" style="width:auto;padding:8px 14px;font-size:13px">–û—á–∏—Å—Ç–∏—Ç—å</button></div></div>
  </div>

  <nav class="bnav">
    <button class="bnav-btn on" data-pg="pgSched"><span class="bi">üìÖ</span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
    <button class="bnav-btn" data-pg="pgEvents"><span class="bi">üìå</span>–°–æ–±—ã—Ç–∏—è</button>
    <button class="bnav-btn" data-pg="pgGrades"><span class="bi">üìä</span>–û—Ü–µ–Ω–∫–∏</button>
  </nav>
</div>

<div class="imgV" id="imgV" onclick="this.classList.remove('open')"><img id="imgVS"></div>

<div class="sheet" id="shL"><div class="shBox"><div class="shH"></div><h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3><input type="hidden" id="elD"><input type="hidden" id="elP"><input type="hidden" id="elW"><div style="margin-bottom:10px"><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–ü—Ä–µ–¥–º–µ—Ç</label><div id="elS"></div></div><div class="shBtns"><button class="btnS" onclick="clS('shL')">–û—Ç–º–µ–Ω–∞</button><button class="btnD" onclick="rmL()">–£–±—Ä–∞—Ç—å</button><button class="btnP" onclick="svL()">–û–∫</button></div></div></div>
<div class="sheet" id="shHI"><div class="shBox"><div class="shH"></div><h3>–î–æ–º–∞—à–∫–∞</h3><input type="hidden" id="hiD"><input type="hidden" id="hiP"><div style="margin-bottom:10px"><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–ü—Ä–µ–¥–º–µ—Ç</label><input class="inp" id="hiS" readonly style="opacity:.5;margin:0"></div><div style="margin-bottom:10px"><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–ó–∞–¥–∞–Ω–∏–µ</label><textarea class="inp" id="hiT" placeholder="–ß—Ç–æ –∑–∞–¥–∞–ª–∏..." style="margin:0"></textarea></div><div><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–§–æ—Ç–æ</label><div class="photoArea"><label class="photoBtn"><input type="file" accept="image/*" multiple hidden onchange="aPh(this,'hiPh')">üì∑ –§–æ—Ç–æ</label><div class="photoPrev" id="hiPh"></div></div></div><div class="shBtns"><button class="btnS" onclick="clS('shHI')">–û—Ç–º–µ–Ω–∞</button><button class="btnP" onclick="svHI()">–û–∫</button></div></div></div>
<div class="sheet" id="shNH"><div class="shBox"><div class="shH"></div><h3>–ù–æ–≤–æ–µ –î–ó</h3><div style="margin-bottom:10px"><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–ü—Ä–µ–¥–º–µ—Ç</label><div id="nhS"></div></div><div style="margin-bottom:10px"><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–ó–∞–¥–∞–Ω–∏–µ</label><textarea class="inp" id="nhT" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." style="margin:0"></textarea></div><div style="margin-bottom:10px"><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–§–æ—Ç–æ</label><div class="photoArea"><label class="photoBtn"><input type="file" accept="image/*" multiple hidden onchange="aPh(this,'nhPh')">üì∑ –§–æ—Ç–æ</label><div class="photoPrev" id="nhPh"></div></div></div><div><label style="display:block;font-size:12px;font-weight:600;color:var(--t2);margin-bottom:4px">–ë–ª–∏–∂–∞–π—à–∞—è –ø–∞—Ä–∞</label><div id="nhNx" style="padding:12px;background:var(--bg3);border-radius:var(--rs);font-size:13px;color:var(--t3)">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</div></div><div class="shBtns"><button class="btnS" onclick="clS('shNH')">–û—Ç–º–µ–Ω–∞</button><button class="btnP" onclick="svNH()">–û–∫</button></div></div></div>
<div class="sheet" id="shSj"><div class="shBox"><div class="shH"></div><h3 id="sjTi">–î–æ–±–∞–≤–∏—Ç—å</h3><input type="hidden" id="sjId"><input class="inp" id="sjN" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"><input class="inp" id="sjR" placeholder="–ê—É–¥–∏—Ç–æ—Ä–∏—è"><input class="inp" id="sjTc" placeholder="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"><div class="shBtns"><button class="btnS" onclick="clS('shSj')">–û—Ç–º–µ–Ω–∞</button><button class="btnP" onclick="svSj()">–û–∫</button></div></div></div>
<div class="sheet" id="shCh"><div class="shBox"><div class="shH"></div><h3>–ó–∞–º–µ–Ω–∞</h3><input type="hidden" id="ceId"><input class="inp" type="date" id="ceD" style="margin-bottom:6px"><p style="font-size:12px;color:var(--t3);margin-bottom:10px">–ù–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É</p><div id="ceP"></div><div class="shBtns"><button class="btnS" onclick="clS('shCh')">–û—Ç–º–µ–Ω–∞</button><button class="btnD" id="ceDl" onclick="rmCh()" style="display:none">–£–¥–∞–ª–∏—Ç—å</button><button class="btnP" onclick="svCh()">–û–∫</button></div></div></div>
<div class="sheet" id="shTm"><div class="shBox"><div class="shH"></div><h3>–í—Ä–µ–º—è –ø–∞—Ä</h3><div id="tmF"></div><div class="shBtns"><button class="btnS" onclick="clS('shTm')">–û—Ç–º–µ–Ω–∞</button><button class="btnP" onclick="svTm()">–û–∫</button></div></div></div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
const isD=()=>innerWidth>=900;
function initTh(){setTh(localStorage.getItem('th')||(matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light'))}
function setTh(t){document.documentElement.setAttribute('data-theme',t);localStorage.setItem('th',t)}
function togTh(){setTh(document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark')}
initTh();
firebase.initializeApp({apiKey:"AIzaSyBCy0hz_PHMGUX2M52Wnwb0C9nEnBBfeq8",authDomain:"my-diary-e223c.firebaseapp.com",databaseURL:"https://my-diary-e223c-default-rtdb.firebaseio.com",projectId:"my-diary-e223c",storageBucket:"my-diary-e223c.firebasestorage.app",messagingSenderId:"903986378920",appId:"1:903986378920:web:b6ebc6691f6d767f78aa9d"});
const au=firebase.auth(),db=firebase.database();au.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
const ADM=["zFKU6TAgIuhZetCOuWpHvDDw6Oj2"],DK=['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'],DL=['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä–µ–¥–∞','–ß–µ—Ç–≤–µ—Ä–≥','–ü—è—Ç–Ω–∏—Ü–∞','–°—É–±–±–æ—Ç–∞'];
let cU=null,isA=false,isG=false,sc={upper:{},lower:{}},hw=[],ch=[],nh=[],sj=[];
let cf={weekStartDate:null,pairTimes:[{start:'08:30',end:'10:00'},{start:'10:10',end:'11:40'},{start:'12:10',end:'13:40'},{start:'13:50',end:'15:20'},{start:'15:30',end:'17:00'}]};
let vM=gM(new Date()),sD=tI(),csS={},uP={hiPh:[],nhPh:[]},cMo=new Date();
function gM(d){const r=new Date(d);r.setHours(12,0,0,0);const w=r.getDay();r.setDate(r.getDate()-w+(w===0?-6:1));return r}
function fk(d){const r=new Date(d);return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,'0')}-${String(r.getDate()).padStart(2,'0')}`}
function pk(s){const[y,m,d]=s.split('-').map(Number);return new Date(y,m-1,d,12)}
function fS(d){return new Date(d).toLocaleDateString('ru-RU',{day:'numeric',month:'short'})}
function fF(d){return new Date(d).toLocaleDateString('ru-RU',{weekday:'long',day:'numeric',month:'long'})}
function tI(){const w=new Date().getDay();return w===0?5:(w-1)}
function esc(t){if(!t)return'';const d=document.createElement('div');d.textContent=t;return d.innerHTML}
function gwt(m){if(!cf.weekStartDate){const s=new Date(m.getFullYear(),0,1);return Math.ceil(((m-s)/864e5+s.getDay()+1)/7)%2===1?'upper':'lower'}const sd=gM(pk(cf.weekStartDate));return Math.floor(Math.round((m-sd)/864e5)/7)%2===0?'upper':'lower'}
function lsF(dk){const d=pk(dk),dow=d.getDay();if(dow===0)return{};const di=dow-1;if(di>5)return{};const c=ch.find(x=>x.date===dk);if(c)return c.lessons||{};return(sc[gwt(gM(d))]||{})[DK[di]]||{}}
function fNx(subj){const td=new Date();td.setHours(0,0,0,0);for(let o=1;o<=60;o++){const d=new Date(td);d.setDate(d.getDate()+o);const dow=d.getDay();if(dow===0||dow>6)continue;const dk=fk(d),ls=lsF(dk);for(let p=1;p<=5;p++){const l=ls[p];if(l&&l.name&&l.name.toLowerCase().trim()===subj.toLowerCase().trim())return{date:dk,pair:p}}}return null}
function recalc(){if(!isA)return;nh.forEach(h=>{if(h.done||!h.subject)return;const n=fNx(h.subject);if(n&&(n.date!==h.targetDate||n.pair!==h.targetPair))db.ref(`newHomework/${h.id}`).update({targetDate:n.date,targetPair:n.pair})})}
let aR=false;
au.onAuthStateChanged(u=>{aR=true;if(u){cU=u;isA=ADM.includes(u.uid);isG=false;boot()}else if(localStorage.getItem('gs')){isG=true;boot()}else{hL();document.getElementById('loginPage').style.display='flex'}});
setTimeout(()=>{if(!aR){hL();document.getElementById('loginPage').style.display='flex'}},4000);
function hL(){const l=document.getElementById('loader');l.classList.add('hide');setTimeout(()=>l.style.display='none',500)}
function doLogin(){const e=document.getElementById('iE').value.trim(),p=document.getElementById('iP').value;if(!e||!p){sE('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å');return}au.signInWithEmailAndPassword(e,p).catch(()=>sE('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'))}
function sE(m){const e=document.getElementById('errMsg');e.textContent=m;e.style.display='block'}
function guestIn(){isG=true;isA=false;cU=null;localStorage.setItem('gs','1');boot()}
function doLogout(){localStorage.removeItem('gs');closePM();au.signOut().then(()=>{isG=false;isA=false;cU=null;document.getElementById('app').style.display='none';document.getElementById('loginPage').style.display='flex'})}
function boot(){document.getElementById('loginPage').style.display='none';document.getElementById('app').style.display='block';document.getElementById('pmInfo').innerHTML=(isG?'–ì–æ—Å—Ç—å':esc(cU?.email||''))+(isA?' <span style="background:var(--blue);color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:800;margin-left:4px">Admin</span>':'');if(isA)document.querySelectorAll('.admH').forEach(e=>e.classList.remove('admH'));setupNav();loadData();sD=tI();vM=gM(new Date());updAll();setTimeout(hL,300)}

/* POPUP MENU */
function togPM(){const bg=document.getElementById('pmBg'),pm=document.getElementById('pmMenu'),a=document.getElementById('hamBtn');if(pm.classList.contains('open')){closePM();return}const r=a.getBoundingClientRect();pm.style.top=(r.bottom+8)+'px';pm.style.right=Math.max(12,innerWidth-r.right)+'px';bg.classList.add('open');pm.classList.add('open')}
function closePM(){document.getElementById('pmBg').classList.remove('open');document.getElementById('pmMenu').classList.remove('open')}

function setupNav(){
  document.querySelectorAll('.bnav-btn').forEach(b=>b.addEventListener('click',()=>{go(b.dataset.pg);document.querySelectorAll('.bnav-btn').forEach(x=>x.classList.remove('on'));b.classList.add('on')}));
  document.querySelectorAll('.dNavBtn').forEach(b=>b.addEventListener('click',()=>{document.querySelectorAll('.dNavBtn').forEach(x=>x.classList.remove('on'));b.classList.add('on');const p=b.dataset.dp;if(p==='sched'){showDW();hideMPg()}else{hideDW();go(p)}}));
}
function go(id){document.querySelectorAll('.pg').forEach(x=>x.classList.remove('on'));document.getElementById(id).classList.add('on');document.getElementById('wbar').style.display=id==='pgSched'?'':'none';document.querySelectorAll('.bnav-btn').forEach(b=>b.classList.toggle('on',b.dataset.pg===id));if(isD()){if(id==='pgSched'){showDW()}else{hideDW()}}}
function showDW(){document.getElementById('dwHead').style.display='';document.getElementById('dwBody').style.display='';rDW()}
function hideDW(){document.getElementById('dwHead').style.display='none';document.getElementById('dwBody').style.display='none'}
function hideMPg(){document.querySelectorAll('.pg').forEach(x=>x.classList.remove('on'))}
function sGT(i){document.querySelectorAll('.gTab').forEach((t,x)=>t.classList.toggle('on',x===i));document.querySelectorAll('.gCon').forEach((c,x)=>c.classList.toggle('on',x===i))}

function loadData(){
  db.ref('settings').on('value',s=>{if(s.val()){cf={...cf,...s.val()};const w=document.getElementById('cfgWS');if(cf.weekStartDate&&w)w.value=cf.weekStartDate}updAll()});
  db.ref('schedule').on('value',s=>{sc=s.val()||{upper:{},lower:{}};render();rDW();recalc()});
  db.ref('homework').on('value',s=>{const d=s.val();hw=d?Object.keys(d).map(k=>({id:k,...d[k]})):[];render();rDW()});
  db.ref('subjects').on('value',s=>{const d=s.val();sj=d?Object.keys(d).map(k=>({id:k,...d[k]})):[];rSj();render();rDW()});
  db.ref('newHomework').on('value',s=>{const d=s.val();nh=d?Object.keys(d).map(k=>({id:k,...d[k]})):[];rHP();render();rEv();rDW()});
  db.ref('changes').on('value',s=>{const d=s.val();ch=d?Object.keys(d).map(k=>({id:k,...d[k]})):[];clnOld();render();rWS();rChg();rEv();rDW();recalc()});
  const w=document.getElementById('cfgWS');if(w)w.addEventListener('change',e=>{if(isA)db.ref('settings/weekStartDate').set(e.target.value)});
}
function clnOld(){if(!isA)return;const tk=fk(new Date());ch.forEach(c=>{if(c.date<tk)db.ref(`changes/${c.id}`).remove()})}
function updAll(){updTop();rWS();render();rEv();if(isD()){rDW();rMC()}}
function updTop(){const t=new Date(),wt=gwt(gM(t));document.getElementById('tDate').textContent=fF(t);const b=document.getElementById('tBdg');b.textContent=wt==='upper'?'‚ñ≤ –í–µ—Ä—Ö–Ω—è—è':'‚ñº –ù–∏–∂–Ω—è—è';b.className='pill '+(wt==='upper'?'up':'lo')}
function prevW(){vM.setDate(vM.getDate()-7);sD=0;updAll()}
function nextW(){vM.setDate(vM.getDate()+7);sD=0;updAll()}
function rWS(){const wr=document.getElementById('wrow'),wl=document.getElementById('wlabel'),tk=fk(new Date()),e=new Date(vM);e.setDate(e.getDate()+5);const wt=gwt(vM);let h=`<button class="warr" onclick="prevW()">‚Äπ</button>`;for(let i=0;i<6;i++){const d=new Date(vM);d.setDate(d.getDate()+i);const dk=fk(d),isT=dk===tk,hasCh=ch.some(x=>x.date===dk);h+=`<button class="dchip${i===sD?' sel':''}${isT?' today':''}" onclick="pickD(${i})">${hasCh?'<span class="dot"></span>':''}<span class="dd">${DK[i]}</span><span class="dn">${d.getDate()}</span></button>`}h+=`<button class="warr" onclick="nextW()">‚Ä∫</button>`;wr.innerHTML=h;wl.innerHTML=`${fS(vM)} ‚Äî ${fS(e)} ¬∑ <span class="${wt==='upper'?'up':'lo'}">${wt==='upper'?'‚ñ≤ –í–µ—Ä—Ö–Ω—è—è':'‚ñº –ù–∏–∂–Ω—è—è'}</span>`}
function pickD(i){sD=i;rWS();render()}
function rEv(){const c=document.getElementById('evList'),tk=fk(new Date());let it=[];ch.filter(x=>x.date>=tk).forEach(x=>it.push({date:x.date,icon:'üîÑ',title:'–ó–∞–º–µ–Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è',desc:fF(pk(x.date))}));it.sort((a,b)=>a.date.localeCompare(b.date));if(!it.length){c.innerHTML='<div class="empty"><div class="ei">üìå</div><div class="et">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div></div>';return}c.innerHTML=it.map(e=>`<div class="evC"><div class="evt">${e.icon} ${esc(e.title)}</div><div class="evd">üìÖ ${esc(e.desc)}</div></div>`).join('')}

function render(){const w=document.getElementById('lList'),d=new Date(vM);d.setDate(d.getDate()+sD);const dk=fk(d),wt=gwt(vM),dayK=DK[sD],cx=ch.find(x=>x.date===dk),hasCh=!!cx,les=hasCh?(cx.lessons||{}):(sc[wt]?.[dayK]||{});let h='';for(let p=1;p<=5;p++){const l=les[p],has=l&&l.name,tm=cf.pairTimes[p-1];const iho=hw.filter(x=>x.date===dk&&x.pair===p),ihn=nh.filter(x=>x.targetDate===dk&&x.targetPair===p);h+=`<div class="lc2${has?'':' empty'}${hasCh&&has?' changed':''}" ${isA?`onclick="openLM('${dayK}',${p},'${wt}')"`:''}>
<div class="pn2"><span class="n">${p}</span><span class="t">${tm?.start||''}</span></div>
<div class="lb">${has?`<div class="ln">${esc(l.name)}</div><div class="lm">${l.room?`<span>üìç${esc(l.room)}</span>`:''}${l.teacher?`<span>üë§${esc(l.teacher)}</span>`:''}</div>${rIH(iho,'–î–æ–º–∞—à–∫–∞','hw')}${rIH(ihn,'–î–ó','nh')}`:`<div class="le">${isA?'+ –î–æ–±–∞–≤–∏—Ç—å':'‚Äî'}</div>`}</div>
${has&&isA?`<div class="la"><button class="mb bl" onclick="event.stopPropagation();openHI('${dk}',${p},'${esc(l.name)}')">+–î–ó</button></div>`:''}</div>`}w.innerHTML=h}

function rIH(list,lbl,tp){if(!list.length)return'';return list.map(h=>{let ph='';if(h.photos&&h.photos.length)ph='<div class="hp">'+h.photos.map(p=>`<img src="${p}" onclick="event.stopPropagation();vI('${p}')">`).join('')+'</div>';return`<div class="hwi${h.done?' done':''}"><div class="hh"><span class="ht">${lbl}</span><div class="hb"><button class="mb ${h.done?'og':'gr'}" onclick="event.stopPropagation();${tp==='hw'?`tHw('${h.id}')`:`tNH('${h.id}')`}">${h.done?'‚Ü©':'‚úì'}</button>${isA?`<button class="mb rd" onclick="event.stopPropagation();${tp==='hw'?`dHw('${h.id}')`:`dNH('${h.id}')`}">‚úï</button>`:''}</div></div><div class="htx">${esc(h.task)}</div>${ph}</div>`}).join('')}

/* DESKTOP WEEK - vertical list */
function rDW(){if(!isD())return;const wt=gwt(vM),tk=fk(new Date()),e=new Date(vM);e.setDate(e.getDate()+5);
document.getElementById('dwHead').innerHTML=`<div class="dwn"><button class="dwnb" onclick="prevW()">‚Äπ</button><h2>${fS(vM)} ‚Äî ${fS(e)}</h2><button class="dwnb" onclick="nextW()">‚Ä∫</button></div><span class="dwb ${wt==='upper'?'up':'lo'}">${wt==='upper'?'‚ñ≤ –í–µ—Ä—Ö–Ω—è—è':'‚ñº –ù–∏–∂–Ω—è—è'}</span>`;
let h='';for(let i=0;i<6;i++){const d=new Date(vM);d.setDate(d.getDate()+i);const dk=fk(d),dayK=DK[i],isT=dk===tk,cx=ch.find(x=>x.date===dk),hasCh=!!cx,les=hasCh?(cx.lessons||{}):(sc[wt]?.[dayK]||{});
h+=`<div class="dDayBlock${isT?' today':''}${hasCh?' hasch':''}"><div class="dDayHead"><span class="ddh-name">${DL[i]}</span><span class="ddh-date">${d.getDate()}.${String(d.getMonth()+1).padStart(2,'0')}</span>${hasCh?'<span class="ddh-badge">‚ö° –ó–∞–º–µ–Ω–∞</span>':''}</div><div class="dDayBody">`;
for(let p=1;p<=5;p++){const l=les[p],has=l&&l.name;h+=`<div class="dLesson${has?'':' empty'}${hasCh&&has?' changed':''}" ${isA?`onclick="openLM('${dayK}',${p},'${wt}')"`:''}>
<div class="dl-pair">${p} –ø–∞—Ä–∞ ¬∑ ${cf.pairTimes[p-1]?.start||''}</div>
<div>${has?`<div class="dl-name">${esc(l.name)}</div><div class="dl-meta">${l.room?'üìç'+esc(l.room):''}${l.teacher?' ¬∑ '+esc(l.teacher):''}</div>`:`<div class="dl-empty">‚Äî</div>`}</div></div>`}
h+=`</div></div>`}document.getElementById('dwBody').innerHTML=h;rMC()}

function rMC(){if(!isD())return;const c=document.getElementById('mCal'),y=cMo.getFullYear(),m=cMo.getMonth(),mn=['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'],first=new Date(y,m,1),sd=(first.getDay()+6)%7,dim=new Date(y,m+1,0).getDate(),tk=fk(new Date());
let h=`<div class="mch"><span class="mct">${mn[m]} ${y}</span><div class="mca"><button class="mcab" onclick="cMo.setMonth(cMo.getMonth()-1);rMC()">‚Äπ</button><button class="mcab" onclick="cMo.setMonth(cMo.getMonth()+1);rMC()">‚Ä∫</button></div></div><div class="mcg">`;
['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'].forEach(d=>h+=`<div class="mcdh">${d}</div>`);
for(let i=0;i<sd;i++){const pd=new Date(y,m,0-sd+i+1);h+=`<div class="mcd other">${pd.getDate()}</div>`}
for(let d=1;d<=dim;d++){const dk=fk(new Date(y,m,d)),cls=dk===tk?' today':'';h+=`<div class="mcd${cls}" onclick="cdC('${dk}')">${d}</div>`}
const rm=(sd+dim)%7;if(rm>0)for(let i=1;i<=7-rm;i++)h+=`<div class="mcd other">${i}</div>`;h+=`</div>`;c.innerHTML=h}
function cdC(dk){const d=pk(dk);vM=gM(d);sD=(d.getDay()+6)%7;if(sD>5)sD=0;updAll()}

function vI(src){document.getElementById('imgVS').src=src;document.getElementById('imgV').classList.add('open')}
function rHP(){const c=document.getElementById('hwList'),tk=fk(new Date()),p=nh.filter(h=>h.targetDate&&h.targetDate>=tk&&!h.done).sort((a,b)=>a.targetDate.localeCompare(b.targetDate));if(!p.length){c.innerHTML='<div class="empty"><div class="ei">üìö</div><div class="et">–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π</div></div>';return}c.innerHTML=p.map(h=>{let ph='';if(h.photos&&h.photos.length)ph='<div class="hp">'+h.photos.map(p=>`<img src="${p}" onclick="vI('${p}')">`).join('')+'</div>';return`<div class="hwC"><div class="hs">üìñ ${esc(h.subject)}</div><div class="hd">üìÖ ${fF(pk(h.targetDate))}</div><div class="htk">${esc(h.task)}</div>${ph}<div class="ha"><button class="btnP" style="padding:6px 12px;font-size:12px;width:auto" onclick="tNH('${h.id}')">‚úì</button>${isA?`<button class="btnD" style="padding:6px 12px;font-size:12px;width:auto" onclick="dNH('${h.id}')">‚úï</button>`:''}</div></div>`}).join('')}
function rSj(){const c=document.getElementById('sjList');if(!sj.length){c.innerHTML='<div class="empty"><div class="ei">üìñ</div><div class="et">–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã</div></div>';return}c.innerHTML=sj.sort((a,b)=>a.name.localeCompare(b.name)).map(s=>`<div class="sjR"><div class="si">üìñ</div><div style="flex:1;min-width:0"><div class="sn">${esc(s.name)}</div><div class="sm">${s.room?'üìç'+esc(s.room):''}${s.teacher?' ¬∑ '+esc(s.teacher):''}</div></div><div style="display:flex;gap:3px"><button class="mb bl" onclick="editSj('${s.id}')">‚úèÔ∏è</button><button class="mb rd" onclick="rmSj('${s.id}')">‚úï</button></div></div>`).join('')}
function rChg(){const c=document.getElementById('chgList'),tk=fk(new Date()),f=ch.filter(x=>x.date>=tk).sort((a,b)=>a.date.localeCompare(b.date));if(!f.length){c.innerHTML='<div class="empty"><div class="ei">üîÑ</div><div class="et">–ù–µ—Ç –∑–∞–º–µ–Ω</div></div>';return}c.innerHTML=f.map(x=>{let ls='';if(x.lessons)for(let p=1;p<=5;p++){const l=x.lessons[p];if(l&&l.name)ls+=`<div class="chL"><span class="cn">${p}</span><div><div style="font-weight:700;font-size:13px">${esc(l.name)}</div><div style="font-size:11px;color:var(--t3)">${l.room?'üìç'+esc(l.room):''}${l.teacher?' ¬∑ '+esc(l.teacher):''}</div></div></div>`}if(!ls)ls='<div style="padding:6px;color:var(--t3);font-size:12px">–ü–∞—Ä—ã —Å–Ω—è—Ç—ã</div>';return`<div class="chC"><div class="chead"><span class="cdt">üìÖ ${fF(pk(x.date))}</span><div style="display:flex;gap:3px"><button class="mb bl" onclick="editCh('${x.id}')">‚úèÔ∏è</button><button class="mb rd" onclick="rmChId('${x.id}')">‚úï</button></div></div>${ls}</div>`}).join('')}

/* PHOTOS */
function aPh(inp,cid){Array.from(inp.files).forEach(f=>{if(f.size>5e6){alert('–ú–∞–∫—Å 5MB');return}const r=new FileReader();r.onload=e=>{if(!uP[cid])uP[cid]=[];uP[cid].push(e.target.result);rPP(cid)};r.readAsDataURL(f)});inp.value=''}
function rPP(cid){const c=document.getElementById(cid);if(!uP[cid])uP[cid]=[];c.innerHTML=uP[cid].map((p,i)=>`<div class="pp"><img src="${p}"><button class="pr" onclick="rP('${cid}',${i})">‚úï</button></div>`).join('')}
function rP(cid,i){uP[cid].splice(i,1);rPP(cid)}

/* CUSTOM SELECT */
function bCS(cid,sid,cb){const c=document.getElementById(cid),sr=[...sj].sort((a,b)=>a.name.localeCompare(b.name)),sel=sr.find(s=>s.id===sid);csS[cid]={selectedId:sid||'',onChange:cb};let trig;if(sel)trig=`<span class="csI">üìñ</span><div class="csTxt" style="flex:1"><div class="csN">${esc(sel.name)}</div><div class="csM">${sel.room?'üìç'+esc(sel.room):''}${sel.teacher?' ¬∑ '+esc(sel.teacher):''}</div></div>`;else trig=`<span class="csPh">‚Äî –ù–µ—Ç ‚Äî</span>`;const opts=sr.map(s=>`<div class="csOpt${s.id===sid?' on':''}" data-sid="${s.id}"><span class="coI">üìñ</span><div><div class="coN">${esc(s.name)}</div><div class="coM">${s.room?'üìç'+esc(s.room):''}${s.teacher?' ¬∑ '+esc(s.teacher):''}</div></div></div>`).join('');c.innerHTML=`<div class="csW"><div class="csTrig" data-cid="${cid}">${trig}<span class="csArr">‚ñº</span></div><div class="csDd" id="${cid}-dd"><div class="csOpt emp" data-sid=""><span class="coI">‚úï</span><div><div class="coN" style="color:var(--t3)">‚Äî –ù–µ—Ç ‚Äî</div></div></div>${opts}</div></div>`;c.querySelector('.csTrig').addEventListener('click',e=>{e.stopPropagation();const dd=document.getElementById(cid+'-dd'),tr=c.querySelector('.csTrig'),wo=dd.classList.contains('open');clCS();if(!wo){dd.classList.add('open');tr.classList.add('open')}});c.querySelectorAll('.csOpt').forEach(o=>{o.addEventListener('click',e=>{e.stopPropagation();const id=o.dataset.sid,sub=id?sj.find(s=>s.id===id):null;csS[cid].selectedId=id;const tr=c.querySelector('.csTrig');if(sub)tr.innerHTML=`<span class="csI">üìñ</span><div class="csTxt" style="flex:1"><div class="csN">${esc(sub.name)}</div><div class="csM">${sub.room?'üìç'+esc(sub.room):''}${sub.teacher?' ¬∑ '+esc(sub.teacher):''}</div></div><span class="csArr">‚ñº</span>`;else tr.innerHTML=`<span class="csPh">‚Äî –ù–µ—Ç ‚Äî</span><span class="csArr">‚ñº</span>`;c.querySelectorAll('.csOpt').forEach(x=>x.classList.remove('on'));o.classList.add('on');clCS();if(csS[cid].onChange)csS[cid].onChange(id,sub)})})}
function clCS(){document.querySelectorAll('.csDd.open').forEach(d=>d.classList.remove('open'));document.querySelectorAll('.csTrig.open').forEach(t=>t.classList.remove('open'))}
function gcs(id){return csS[id]?.selectedId||''}
document.addEventListener('click',()=>clCS());

function openLM(d,p,w){if(!isA)return;document.getElementById('elD').value=d;document.getElementById('elP').value=p;document.getElementById('elW').value=w;const l=sc[w]?.[d]?.[p]||{};let sid='';if(l.name){const s=sj.find(x=>x.name===l.name);if(s)sid=s.id}bCS('elS',sid,null);opS('shL')}
function svL(){if(!isA)return;const d=document.getElementById('elD').value,p=document.getElementById('elP').value,w=document.getElementById('elW').value,sid=gcs('elS'),sub=sj.find(s=>s.id===sid);if(sub)db.ref(`schedule/${w}/${d}/${p}`).set({name:sub.name,room:sub.room||'',teacher:sub.teacher||''});else db.ref(`schedule/${w}/${d}/${p}`).remove();clS('shL')}
function rmL(){if(!isA)return;db.ref(`schedule/${document.getElementById('elW').value}/${document.getElementById('elD').value}/${document.getElementById('elP').value}`).remove();clS('shL')}
function openHI(dk,p,s){if(!isA)return;document.getElementById('hiD').value=dk;document.getElementById('hiP').value=p;document.getElementById('hiS').value=s;document.getElementById('hiT').value='';uP.hiPh=[];rPP('hiPh');opS('shHI')}
function svHI(){if(!isA)return;const t=document.getElementById('hiT').value.trim();if(!t){alert('–ó–∞–¥–∞–Ω–∏–µ');return}const data={date:document.getElementById('hiD').value,pair:parseInt(document.getElementById('hiP').value),subject:document.getElementById('hiS').value,task:t,done:false,created:new Date().toISOString()};if(uP.hiPh.length)data.photos=uP.hiPh;db.ref('homework').push(data);clS('shHI')}
function tHw(id){const h=hw.find(x=>x.id===id);if(h)db.ref(`homework/${id}/done`).set(!h.done)}
function dHw(id){if(!isA)return;if(confirm('–£–¥–∞–ª–∏—Ç—å?'))db.ref(`homework/${id}`).remove()}
function openNewHw(){if(!isA)return;bCS('nhS','',(_,sub)=>{const info=document.getElementById('nhNx');if(sub&&sub.name){const n=fNx(sub.name);if(n)info.innerHTML=`<span style="color:var(--blue);font-weight:700">üìÖ ${fF(pk(n.date))}</span>, –ø–∞—Ä–∞ ${n.pair}`;else info.innerHTML='<span style="color:var(--red)">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</span>'}else info.textContent='–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç'});document.getElementById('nhT').value='';document.getElementById('nhNx').textContent='–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç';uP.nhPh=[];rPP('nhPh');opS('shNH')}
function svNH(){if(!isA)return;const sid=gcs('nhS'),sub=sj.find(s=>s.id===sid);if(!sub){alert('–ü—Ä–µ–¥–º–µ—Ç');return}const t=document.getElementById('nhT').value.trim();if(!t){alert('–ó–∞–¥–∞–Ω–∏–µ');return}const n=fNx(sub.name);if(!n){alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ');return}const data={subject:sub.name,task:t,targetDate:n.date,targetPair:n.pair,done:false,created:new Date().toISOString()};if(uP.nhPh.length)data.photos=uP.nhPh;db.ref('newHomework').push(data);clS('shNH')}
function tNH(id){const h=nh.find(x=>x.id===id);if(h)db.ref(`newHomework/${id}/done`).set(!h.done)}
function dNH(id){if(!isA)return;if(confirm('–£–¥–∞–ª–∏—Ç—å?'))db.ref(`newHomework/${id}`).remove()}
function openSjM(eid){document.getElementById('sjId').value=eid||'';document.getElementById('sjN').value='';document.getElementById('sjR').value='';document.getElementById('sjTc').value='';document.getElementById('sjTi').textContent=eid?'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å':'–î–æ–±–∞–≤–∏—Ç—å';if(eid){const s=sj.find(x=>x.id===eid);if(s){document.getElementById('sjN').value=s.name||'';document.getElementById('sjR').value=s.room||'';document.getElementById('sjTc').value=s.teacher||''}}opS('shSj')}
function editSj(id){openSjM(id)}
function svSj(){const id=document.getElementById('sjId').value,n=document.getElementById('sjN').value.trim(),r=document.getElementById('sjR').value.trim(),t=document.getElementById('sjTc').value.trim();if(!n){alert('–ù–∞–∑–≤–∞–Ω–∏–µ');return}if(id)db.ref(`subjects/${id}`).set({name:n,room:r,teacher:t});else db.ref('subjects').push({name:n,room:r,teacher:t});clS('shSj')}
function rmSj(id){if(confirm('–£–¥–∞–ª–∏—Ç—å?'))db.ref(`subjects/${id}`).remove()}
function openChgM(eid){if(!isA)return;document.getElementById('ceId').value=eid||'';document.getElementById('ceDl').style.display=eid?'':'none';document.getElementById('ceD').value='';let h='';for(let i=1;i<=5;i++)h+=`<div class="cpB"><div class="cpH"><span class="cpN">${i}</span><span style="font-size:13px;font-weight:600;color:var(--t2)">–ø–∞—Ä–∞</span></div><div id="cs-c${i}"></div></div>`;document.getElementById('ceP').innerHTML=h;for(let i=1;i<=5;i++)bCS(`cs-c${i}`,'',null);if(eid){const c=ch.find(x=>x.id===eid);if(c){document.getElementById('ceD').value=c.date;if(c.lessons)for(let i=1;i<=5;i++){const l=c.lessons[i];if(l&&l.name){const s=sj.find(x=>x.name===l.name);if(s)bCS(`cs-c${i}`,s.id,null)}}}}opS('shCh')}
function editCh(id){openChgM(id)}
function svCh(){if(!isA)return;const eid=document.getElementById('ceId').value,date=document.getElementById('ceD').value;if(!date){alert('–î–∞—Ç–∞');return}const les={};let any=false;for(let i=1;i<=5;i++){const sid=gcs(`cs-c${i}`),sub=sj.find(s=>s.id===sid);if(sub){les[i]={name:sub.name,room:sub.room||'',teacher:sub.teacher||''};any=true}}if(eid)db.ref(`changes/${eid}`).set({date,lessons:any?les:null});else db.ref('changes').push({date,lessons:any?les:null});clS('shCh')}
function rmCh(){const id=document.getElementById('ceId').value;if(id){rmChId(id);clS('shCh')}}
function rmChId(id){if(!isA)return;if(confirm('–£–¥–∞–ª–∏—Ç—å?'))db.ref(`changes/${id}`).remove()}
function openTM(){if(!isA)return;document.getElementById('tmF').innerHTML=cf.pairTimes.map((t,i)=>`<div style="display:flex;gap:6px;align-items:center;margin-bottom:8px"><span style="min-width:46px;font-weight:700;font-size:13px">${i+1} –ø–∞—Ä–∞</span><input type="time" class="inp" id="ts${i}" value="${t.start}" style="flex:1;margin:0;padding:10px"><span style="color:var(--t3)">‚Äî</span><input type="time" class="inp" id="te${i}" value="${t.end}" style="flex:1;margin:0;padding:10px"></div>`).join('');opS('shTm')}
function svTm(){if(!isA)return;const t=[];for(let i=0;i<5;i++)t.push({start:document.getElementById(`ts${i}`).value,end:document.getElementById(`te${i}`).value});db.ref('settings/pairTimes').set(t);clS('shTm')}
function clrAll(){if(!isA)return;if(confirm('–£–¥–∞–ª–∏—Ç—å –í–°–Å?')){db.ref('schedule').remove();db.ref('homework').remove();db.ref('newHomework').remove();db.ref('changes').remove();db.ref('subjects').remove()}}
function opS(id){document.getElementById(id).classList.add('open')}
function clS(id){document.getElementById(id).classList.remove('open')}
document.querySelectorAll('.sheet').forEach(s=>s.addEventListener('click',e=>{if(e.target===s)s.classList.remove('open')}));
document.getElementById('iP').addEventListener('keypress',e=>{if(e.key==='Enter')doLogin()});
document.getElementById('iE').addEventListener('keypress',e=>{if(e.key==='Enter')document.getElementById('iP').focus()});
let tx=0;document.addEventListener('touchstart',e=>{tx=e.touches[0].clientX},{passive:true});document.addEventListener('touchend',e=>{if(!document.getElementById('pgSched').classList.contains('on'))return;const dx=e.changedTouches[0].clientX-tx;if(Math.abs(dx)>70){if(dx<0&&sD<5){sD++;rWS();render()}else if(dx>0&&sD>0){sD--;rWS();render()}}});
window.addEventListener('resize',()=>{if(isD()){rDW();rMC()}});
</script>
</body>
</html>
